# 中文字体配置指南

## 问题说明

在运行包含中文标签的matplotlib图表时，可能会出现以下警告：
```
UserWarning: Glyph 24133 (\N{CJK UNIFIED IDEOGRAPH-5E45}) missing from font(s) DejaVu Sans.
```

这是因为matplotlib默认使用的DejaVu Sans字体不支持中文字符。

## ✅ 已自动配置

**好消息！** 所有脚本已经自动配置了中文字体支持，你不需要手动操作！

脚本会自动：
1. 检测你的操作系统
2. 选择合适的中文字体
3. 配置matplotlib使用该字体

## 🚀 快速测试

运行以下命令测试中文字体是否配置成功：

```bash
cd code/utils
python chinese_font_config.py
```

这会：
- 列出系统中可用的中文字体
- 配置matplotlib
- 生成测试图表

如果测试图表中的中文正常显示，说明配置成功！

## 📝 支持的字体

### Windows
- SimHei (黑体) - 推荐
- Microsoft YaHei (微软雅黑)
- SimSun (宋体)
- KaiTi (楷体)

### macOS
- PingFang SC (苹方)
- Heiti SC (黑体)
- STHeiti
- Arial Unicode MS

### Linux
- WenQuanYi Micro Hei (文泉驿微米黑)
- WenQuanYi Zen Hei (文泉驿正黑)
- Droid Sans Fallback
- AR PL UMing CN

## 🔧 手动配置（如果自动配置失败）

### 方法1: 安装字体（推荐）

**Windows:**
1. 系统自带SimHei和微软雅黑，无需额外安装
2. 如果仍有问题，右键字体文件→"为所有用户安装"

**Linux (Ubuntu/Debian):**
```bash
sudo apt-get install fonts-wqy-microhei fonts-wqy-zenhei
```

**macOS:**
系统自带中文字体，无需额外安装

### 方法2: 修改matplotlib配置文件

找到matplotlib配置文件位置：
```python
import matplotlib
print(matplotlib.matplotlib_fname())
```

编辑该文件，找到以下行并修改：
```
font.sans-serif: SimHei, Microsoft YaHei, Arial Unicode MS
axes.unicode_minus: False
```

### 方法3: 在代码中手动设置

在脚本开头添加：
```python
import matplotlib.pyplot as plt

# Windows
plt.rcParams['font.sans-serif'] = ['SimHei']

# macOS
# plt.rcParams['font.sans-serif'] = ['PingFang SC']

# Linux
# plt.rcParams['font.sans-serif'] = ['WenQuanYi Micro Hei']

# 解决负号显示问题
plt.rcParams['axes.unicode_minus'] = False
```

## 🎯 已更新的脚本

以下脚本已自动配置中文字体：
- ✅ code/week01_basics/emg_concept_demo.py
- ✅ code/week02_device/device_components.py
- ✅ code/week02_device/sampling_demo.py
- ✅ 所有其他包含中文的脚本

## ❓ 常见问题

### Q1: 警告信息还在，但图表正常显示
A: 这是正常的。只要图表中的中文能够显示，警告可以忽略。

### Q2: 图表中的中文显示为方块
A: 需要安装中文字体。参考上面的"手动配置"部分。

### Q3: Linux上没有中文字体
A: 安装文泉驿字体：
```bash
sudo apt-get install fonts-wqy-microhei fonts-wqy-zenhei
fc-cache -fv  # 刷新字体缓存
```

### Q4: 如何查看系统中的所有字体
A: 运行：
```python
from matplotlib.font_manager import FontManager
fm = FontManager()
for font in fm.ttflist:
    print(font.name)
```

### Q5: 完全禁用警告
A: 在脚本开头添加：
```python
import warnings
warnings.filterwarnings('ignore')
```

## 📚 其他解决方案

如果以上方法都不起作用，可以：

1. **使用英文标签**: 将图表标题和标签改为英文
2. **保存图片时指定字体**:
   ```python
   plt.savefig('output.png', dpi=150, bbox_inches='tight')
   ```
3. **使用Seaborn**: 某些情况下seaborn对字体处理更好

## 🎉 测试成功标志

运行脚本后，如果看到：
```
✓ 中文字体配置成功: SimHei
```

并且图表中的中文正常显示，说明配置成功！

---

**注意**:
- 第一次运行时可能需要几秒钟来查找和配置字体
- 配置成功后，后续运行会很快
- 不同的matplotlib版本可能有细微差异

**需要帮助?** 查看完整的学习计划文档或在GitHub Issues提问
