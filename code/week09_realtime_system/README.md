# 第9周：实时EMG系统

## 学习目标
- 理解实时信号处理的挑战
- 实现实时数据采集和处理
- 构建实时手势识别系统
- 掌握延迟优化技巧

## 本周内容

### 1. 实时系统架构
- 数据采集线程
- 信号处理线程
- 分类识别线程
- 结果显示线程

### 2. 关键技术
- 环形缓冲区（Ring Buffer）
- 滑动窗口实时更新
- 多线程/多进程
- 延迟优化

### 3. 实时处理流程
1. 实时数据采集（模拟或真实设备）
2. 在线滤波
3. 滑动窗口特征提取
4. 实时分类
5. 结果可视化

### 4. 性能要求
- 处理延迟 < 100ms
- 分类刷新率 > 10Hz
- CPU占用 < 50%
- 稳定运行 > 1小时

## 文件说明
- `realtime_processor.py` - 实时处理核心
- `data_buffer.py` - 环形缓冲区实现
- `realtime_classifier.py` - 实时分类器
- `realtime_demo.py` - 完整演示系统
- `performance_profiler.py` - 性能分析工具

## 实践任务
1. 运行realtime_demo.py体验实时系统
2. 使用performance_profiler.py分析性能瓶颈
3. 优化系统降低延迟
4. 测试系统稳定性

## 作业
1. 实现真实EMG设备的数据采集（如有设备）
2. 优化处理流程，降低延迟到50ms以下
3. 添加实时可视化界面
4. 实现手势控制应用（如游戏控制、鼠标控制）

## 学习资源

### 实时系统设计
- Python多线程教程
- 信号处理实时性优化
- Week 6-8的核心模块（作为实时处理的基础）

### 设备接口
- [PySerial文档](https://pyserial.readthedocs.io/) - 串口通信
- [Merletti教程](https://www.robertomerletti.it/it/emg/material/tutorials/) - 实时采集
- 设备厂商SDK文档（如使用商业设备）

### 在线资源
- [实时EMG控制案例](https://www.bilibili.com/opus/676738656717766660) - B站演示
- [EMG信号处理合集](https://blog.csdn.net/YINTENAXIONGNAIER/article/details/134566397) - 实时处理

### 性能优化
- NumPy优化技巧
- Cython加速
- 并行计算

### 完整资源
查看 [../../docs/EMG学习资源汇总.md](../../docs/EMG学习资源汇总.md)

## 系统架构图

```
┌─────────────────┐
│  EMG设备/模拟器  │
└────────┬────────┘
         │ 数据流
         ↓
┌─────────────────┐
│   环形缓冲区     │
│  (Ring Buffer)  │
└────────┬────────┘
         │
         ↓
┌─────────────────┐
│  实时滤波器      │
│ (Butterworth)   │
└────────┬────────┘
         │
         ↓
┌─────────────────┐
│  滑动窗口        │
│  特征提取        │
└────────┬────────┘
         │
         ↓
┌─────────────────┐
│  实时分类器      │
│ (RF/SVM/KNN)    │
└────────┬────────┘
         │
         ↓
┌─────────────────┐
│  结果输出        │
│  (显示/控制)     │
└─────────────────┘
```

## 性能优化技巧

### 1. 减少计算量
- 使用预计算的滤波器系数
- 缓存中间结果
- 只计算必要的特征

### 2. 高效的数据结构
- 使用NumPy数组而非Python列表
- 预分配数组空间
- 避免频繁的内存分配

### 3. 并行处理
- 使用多线程处理不同通道
- GPU加速（如有条件）
- 异步I/O

### 4. 算法优化
- 选择计算复杂度低的特征
- 使用轻量级分类器
- 降低采样率（如不影响性能）

## 常见问题

### Q: 延迟太高怎么办？
A: 检查以下几点：
1. 窗口大小是否过大
2. 提取的特征是否过多
3. 分类器是否过于复杂
4. 是否有不必要的可视化更新

### Q: 系统不稳定，经常崩溃？
A: 可能原因：
1. 线程同步问题
2. 内存泄漏
3. 异常处理不完善
4. 硬件连接不稳定

### Q: 如何测试没有真实设备？
A: 使用模拟器：
- 从文件读取数据模拟实时流
- 生成随机EMG信号
- 使用之前采集的数据回放

## 实际应用示例

完成本周后，你可以实现：
1. **手势控制鼠标** - 用肌电控制电脑
2. **游戏控制** - EMG输入玩游戏
3. **康复监测** - 实时跟踪肌肉活动
4. **假肢控制** - 意图识别和控制

## 重要提示

实时系统是前面所有知识的综合应用：
- Week 6的滤波
- Week 7的特征提取
- Week 8的分类识别
- 加上实时性优化

务必确保前面的基础扎实！
