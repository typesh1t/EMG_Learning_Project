# 手部EMG数据采集指南

> 如何采集高质量的手部抓紧/松开EMG数据

---

## 📋 目录

1. [采集前准备](#采集前准备)
2. [电极放置位置](#电极放置位置)
3. [采集流程](#采集流程)
4. [数据质量检查](#数据质量检查)
5. [常见问题解决](#常见问题解决)
6. [数据组织](#数据组织)

---

## 🎯 采集前准备

### 所需硬件
- ✅ EMG采集设备（Arduino + 肌电传感器，或MyoWare，或OpenBCI）
- ✅ 表面电极（Ag/AgCl，粘贴式）
- ✅ 导电膏或酒精棉片
- ✅ 电极导线
- ✅ 计算机（用于记录数据）
- ✅ USB数据线

### 所需软件
- ✅ Python环境（已安装numpy, pandas, pyserial）
- ✅ 数据采集脚本（在 `tools/data_collector.py`）
- ✅ 串口通信驱动（如需要）

### 被试准备
1. **皮肤准备**: 清洁前臂皮肤
   - 用酒精棉片擦拭电极放置区域
   - 去除皮肤表面的油脂和死皮
   - 等待皮肤完全干燥（约1分钟）

2. **环境要求**:
   - 安静的室内环境
   - 舒适的座椅
   - 桌面高度适宜（前臂自然放置）
   - 避免强电磁干扰源（远离大功率电器）

3. **被试状态**:
   - 休息充分，避免疲劳
   - 前臂放松，不要紧张
   - 理解采集任务和手势要求

---

## 📍 电极放置位置

### 手部抓紧/松开相关肌肉

主要监测前臂的**屈肌群**和**伸肌群**：

#### 1. 前臂屈肌（手掌侧）- 主要负责握拳

**推荐电极位置**：
- **通道1**: 屈指浅肌（Flexor Digitorum Superficialis）
  - 位置：前臂内侧，距离肘关节约1/3处
  - 功能：控制手指弯曲（握拳）

- **通道2**: 屈腕肌（Flexor Carpi）
  - 位置：前臂内侧，靠近腕部
  - 功能：辅助握拳和腕部弯曲

#### 2. 前臂伸肌（手背侧）- 主要负责张开

**推荐电极位置**：
- **通道3**: 伸指肌（Extensor Digitorum）
  - 位置：前臂外侧，距离肘关节约1/3处
  - 功能：控制手指伸展（张开）

- **通道4**: 伸腕肌（Extensor Carpi）
  - 位置：前臂外侧，靠近腕部
  - 功能：辅助手张开和腕部伸展

### 电极放置图示

```
前臂内侧（手掌面）          前臂外侧（手背面）

    肘部                      肘部
     ↓                         ↓
    [Ch1]  ← 屈指浅肌         [Ch3]  ← 伸指肌
     |                         |
     |                         |
    [Ch2]  ← 屈腕肌           [Ch4]  ← 伸腕肌
     |                         |
    腕部                      腕部
     ↓                         ↓
    手掌                      手背
```

### 参考电极（接地）

- **位置**: 肘部骨性突起（尺骨鹰嘴）或手腕骨性部位
- **作用**: 提供参考电位，减少共模干扰

### 电极放置步骤

1. **定位肌肉**:
   - 让被试做握拳和张开动作
   - 用手指触摸前臂，感受肌肉收缩位置
   - 标记电极放置点

2. **清洁皮肤**:
   - 用酒精棉片擦拭标记点
   - 等待干燥

3. **涂导电膏** (如果使用湿电极):
   - 在电极上涂少量导电膏
   - 不要涂太多（会造成通道间串扰）

4. **粘贴电极**:
   - 按照标记位置粘贴
   - 确保电极与皮肤紧密接触
   - 避免电极移动

5. **固定导线**:
   - 用医用胶带固定导线
   - 避免导线晃动（会引入运动伪影）
   - 留有适当松弛度

6. **连接设备**:
   - 将电极导线连接到采集设备
   - 检查通道对应关系
   - 连接参考电极

---

## 🎬 采集流程

### 采集前测试

1. **信号质量检查**:
   ```bash
   # 运行实时查看器检查信号
   python tools/signal_viewer.py --port COM3
   ```

   - 查看静息状态下的基线是否稳定
   - 做握拳动作，观察信号是否有明显变化
   - 检查是否有50/60Hz工频干扰

2. **调整电极** (如果信号质量不佳):
   - 重新清洁皮肤
   - 调整电极位置
   - 检查导线连接

### 手势定义

需要采集的3种基本手势：

#### 1. 静息 (Rest)
- **动作**: 手自然放松，放在桌面上
- **要求**: 完全放松，不要用力
- **时长**: 5秒

#### 2. 握拳 (Fist)
- **动作**: 用力握紧拳头
- **要求**:
  - 中等力度（约50-70%最大力量）
  - 保持力度均匀
  - 不要过度用力（避免疲劳）
- **时长**: 3-5秒

#### 3. 张开 (Open)
- **动作**: 手掌完全张开，手指伸直分开
- **要求**:
  - 手指尽量伸展
  - 保持姿势稳定
- **时长**: 3-5秒

### 采集协议

#### 标准采集方案（推荐）

**每种手势采集次数**: 30-50次
**每次时长**: 5秒
**动作间休息**: 3-5秒

**完整流程**（单个受试者）:

```
1. 准备阶段（5分钟）
   - 电极放置
   - 信号质量检查
   - 讲解任务

2. 练习阶段（2分钟）
   - 每种手势练习3-5次
   - 熟悉动作要求

3. 正式采集

   【Block 1: 静息】
   - 重复30次，每次5秒
   - 每次间隔3秒
   - 总耗时: ~4分钟

   【休息 2分钟】

   【Block 2: 握拳】
   - 重复40次，每次5秒
   - 每次间隔3-5秒（避免疲劳）
   - 总耗时: ~5-6分钟

   【休息 3分钟】（重要！避免疲劳）

   【Block 3: 张开】
   - 重复40次，每次5秒
   - 每次间隔3秒
   - 总耗时: ~5分钟

4. 结束
   - 总采集时间: ~20-25分钟
   - 移除电极
   - 清洁皮肤
```

#### 简化方案（时间有限）

每种手势采集15-20次即可，总时间约10-15分钟。

### 采集注意事项

✅ **DO - 应该做的**:
- 保持姿势一致（前臂位置、手腕角度）
- 保持力度一致（特别是握拳）
- 动作间充分休息
- 记录任何异常情况

❌ **DON'T - 不应该做的**:
- 不要过度用力（容易疲劳）
- 不要移动前臂（会引入运动伪影）
- 不要紧张（会影响信号）
- 不要连续采集太久（疲劳会影响信号特征）

### 数据记录

**使用采集脚本**:

```bash
# 采集单个手势
python tools/data_collector.py \
    --port COM3 \
    --gesture fist \
    --trials 40 \
    --duration 5 \
    --output ../data/raw/subject_01/fist/
```

**脚本会自动**:
- 显示倒计时提示
- 记录每次试验数据
- 保存为CSV格式
- 添加时间戳和标签

---

## ✅ 数据质量检查

采集后立即检查数据质量，避免重复劳动。

### 1. 可视化检查

```python
import pandas as pd
import matplotlib.pyplot as plt

# 加载数据
data = pd.read_csv('subject_01/fist/trial_001.csv')

# 绘制所有通道
fig, axes = plt.subplots(4, 1, figsize=(12, 10))
for i in range(4):
    axes[i].plot(data['time'], data[f'channel_{i}'])
    axes[i].set_ylabel(f'Ch{i} (mV)')
    axes[i].grid(True)
axes[-1].set_xlabel('Time (s)')
plt.tight_layout()
plt.show()
```

### 2. 质量指标

检查以下指标：

#### ✅ 好的信号特征：
- 静息时信号幅度小（< 0.1 mV）
- 激活时信号幅度明显增大（0.5-5 mV）
- 信号看起来"毛刺状"（不是平滑的正弦波）
- 没有明显的基线漂移
- 没有突然的跳变或饱和

#### ❌ 坏的信号特征：
- 基线漂移严重（信号整体上升或下降）
- 信号饱和（达到最大或最小值）
- 信号太弱（激活时幅度很小）
- 明显的50/60Hz工频干扰（规律的正弦波）
- 大量运动伪影（突然的大幅跳变）

### 3. SNR计算

```python
import numpy as np

def calculate_snr(signal):
    """简单的SNR计算"""
    # 假设前1秒是静息
    noise = signal[:1000]  # 假设fs=1000Hz
    # 1-4秒是激活
    active = signal[1000:4000]

    noise_power = np.var(noise)
    signal_power = np.mean(active**2)

    snr = 10 * np.log10(signal_power / noise_power)
    return snr

# 对每个通道计算SNR
for i in range(4):
    signal = data[f'channel_{i}'].values
    snr = calculate_snr(signal)
    print(f"Channel {i} SNR: {snr:.2f} dB")
```

**SNR标准**:
- **优秀**: SNR > 20 dB
- **良好**: SNR 10-20 dB
- **可接受**: SNR 5-10 dB
- **需重新采集**: SNR < 5 dB

---

## 🔧 常见问题解决

### 问题1: 信号太弱

**可能原因**:
- 电极接触不良
- 电极位置不对（不在肌肉上）
- 皮肤阻抗高

**解决方法**:
- 重新清洁皮肤，用力擦拭（去除死皮）
- 使用导电膏
- 调整电极位置，确保在肌肉腹部
- 检查设备增益设置

### 问题2: 工频干扰严重（50/60Hz正弦波）

**可能原因**:
- 参考电极接触不良
- 设备未接地
- 周围有强电磁干扰源

**解决方法**:
- 检查参考电极，确保良好接触
- 设备接地
- 远离大功率电器（台灯、充电器等）
- 使用屏蔽导线
- 后期用陷波滤波器处理

### 问题3: 基线漂移

**可能原因**:
- 电极移动
- 导线晃动
- 呼吸运动

**解决方法**:
- 固定电极和导线
- 前臂保持静止，放在桌面上
- 后期用高通滤波器处理（20Hz）

### 问题4: 信号饱和（削波）

**可能原因**:
- 用力过大
- 设备增益过高

**解决方法**:
- 降低用力程度
- 降低设备增益
- 检查ADC量程设置

### 问题5: 不同手势信号差异不明显

**可能原因**:
- 电极位置不佳
- 动作做得不规范
- 力度不够

**解决方法**:
- 重新定位电极（确保在目标肌肉上）
- 重新讲解动作要求
- 增大动作幅度和力度
- 可以先做夸张的动作，观察哪块肌肉活动最强

---

## 📁 数据组织

### 目录结构

采集的数据应按照以下结构组织：

```
data/raw/
├── subject_01/
│   ├── rest/
│   │   ├── trial_001.csv
│   │   ├── trial_002.csv
│   │   └── ...
│   ├── fist/
│   │   ├── trial_001.csv
│   │   ├── trial_002.csv
│   │   └── ...
│   ├── open/
│   │   └── ...
│   └── subject_info.txt  # 记录受试者信息
│
├── subject_02/
│   └── ...
│
└── README.txt  # 记录采集日期、设备信息等
```

### CSV文件格式

```csv
time,channel_0,channel_1,channel_2,channel_3,label
0.000,0.023,-0.015,0.008,0.012,fist
0.001,0.025,-0.018,0.010,0.015,fist
0.002,0.120,0.085,0.095,0.110,fist
...
```

### 元数据记录

**subject_info.txt 示例**:
```
Subject ID: 01
Age: 17
Gender: Male
Handedness: Right (采集右手)
Date: 2026-01-29
Device: MyoWare Sensor + Arduino Uno
Sampling Rate: 1000 Hz
Electrode Type: Ag/AgCl disposable
Electrode Placement:
  - Ch0: Flexor Digitorum Superficialis
  - Ch1: Flexor Carpi
  - Ch2: Extensor Digitorum
  - Ch3: Extensor Carpi
Notes:
  - Signal quality good
  - Slight 50Hz interference on Ch2
  - Subject reported no fatigue
```

---

## 📊 采集后的下一步

1. **数据质量检查** (第一步！)
   - 可视化所有文件
   - 计算SNR
   - 标记需要重新采集的数据

2. **数据预处理**
   - 滤波（带通 20-500Hz，陷波 50/60Hz）
   - 去除异常值
   - 保存处理后的数据到 `data/processed/`

3. **特征提取**
   - 使用滑动窗口
   - 提取时域和频域特征
   - 保存特征到 `data/features/`

4. **模型训练**
   - 准备训练集和测试集
   - 训练分类器
   - 评估性能

---

## 💡 高级技巧

### 1. 多种力度采集

除了标准力度，可以采集不同力度的握拳：
- 轻握（20-30%最大力量）
- 中握（50-60%最大力量）
- 强握（80-90%最大力量）

这样可以研究力度估计。

### 2. 长时间监测

采集10-15分钟的持续数据，用于：
- 研究肌肉疲劳（频率特征下降）
- 实时系统测试
- 信号稳定性分析

### 3. 多天采集

在不同天（间隔1-7天）采集同一受试者的数据：
- 研究日间变异性
- 测试模型鲁棒性
- 评估电极放置一致性

---

## 📚 参考资源

### 视频教程
- [YouTube: 如何放置表面EMG电极](https://youtube.com)（替换为实际链接）
- [前臂肌肉解剖](https://youtube.com)

### 文献
- SENIAM项目：表面肌电电极放置标准
  http://www.seniam.org/

### 工具
- 在线EMG肌肉定位工具
- 电极放置图谱

---

## ✅ 检查清单

采集前：
- [ ] 硬件准备齐全
- [ ] 软件环境配置完成
- [ ] 被试休息充分
- [ ] 皮肤清洁
- [ ] 电极位置标记

采集中：
- [ ] 信号质量良好
- [ ] 动作规范
- [ ] 力度一致
- [ ] 定期休息

采集后：
- [ ] 数据保存完整
- [ ] 质量检查通过
- [ ] 元数据记录完整
- [ ] 文件命名规范

---

**祝采集顺利！如有问题，请查看常见问题部分或联系导师。** 🎯

**最后更新**: 2026-01-29
